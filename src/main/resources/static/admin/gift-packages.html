<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω G√≥i Qu√† - Admin</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="admin-style.css">
    <style>
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center
        }

        .modal.show {
            display: flex
        }

        .modal-content {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto
        }

        .form-group {
            margin-bottom: 1rem
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px
        }

        .form-group textarea {
            min-height: 100px
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem
        }

        .package-image {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px
        }
    </style>
</head>

<body>
    <div class="admin-container">
        <aside class="admin-sidebar">
            <h2>Admin Panel</h2>
            <ul class="admin-menu">
                <li><a href="/admin/dashboard.html">Dashboard</a></li>
                <li><a href="/admin/books.html">Qu·∫£n L√Ω S√°ch</a></li>
                <li><a href="/admin/orders.html">Qu·∫£n L√Ω ƒê∆°n H√†ng</a></li>
                <li><a href="/admin/gift-orders.html">Qu·∫£n L√Ω ƒê∆°n Qu√† T·∫∑ng</a></li>
                <li><a href="/admin/gift-packages.html" class="active">Qu·∫£n L√Ω G√≥i Qu√†</a></li>
                <li><a href="/admin/users.html">Qu·∫£n L√Ω Ng∆∞·ªùi D√πng</a></li>
                <li><a href="/admin/memberships.html">Qu·∫£n L√Ω Th·∫ª Th√†nh Vi√™n</a></li>
                <li><a href="/index.html">V·ªÅ Trang Ch·ªß</a></li>
            </ul>
        </aside>
        <main class="admin-content">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem">
                <h1 style="color:#2d6a4f;margin:0">Qu·∫£n L√Ω G√≥i Qu√†</h1>
                <button class="btn btn-primary" onclick="showAddModal()">Th√™m G√≥i Qu√† M·ªõi</button>
            </div>
            <div style="margin-bottom:1rem">
                <input type="text" id="searchInput" placeholder="üîç T√¨m ki·∫øm theo t√™n g√≥i, lo·∫°i h·ªôp, thi·ªáp..."
                    style="width:100%;max-width:500px;padding:0.75rem;border:1px solid #ddd;border-radius:4px;font-size:14px"
                    oninput="filterPackages()">
            </div>
            <div class="admin-section">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>H√¨nh ·∫¢nh</th>
                            <th>T√™n G√≥i</th>
                            <th>H·ªôp Qu√†</th>
                            <th>Thi·ªáp</th>
                            <th>Gi·∫•y G√≥i</th>
                            <th>Ph√≠ G√≥i</th>
                            <th>Thao T√°c</th>
                        </tr>
                    </thead>
                    <tbody id="packagesTable">
                        <tr>
                            <td colspan="8" style="text-align:center">ƒêang t·∫£i...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>
    <div id="packageModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Th√™m G√≥i Qu√† M·ªõi</h2>
            <form id="packageForm">
                <div class="form-group">
                    <label>ID</label>
                    <input type="number" id="packageId" readonly style="background:#f5f5f5">
                </div>
                <div class="form-group">
                    <label>T√™n G√≥i Qu√† *</label>
                    <input type="text" id="packageName" required maxlength="100">
                </div>
                <div class="form-group">
                    <label>Lo·∫°i H·ªôp Qu√†</label>
                    <input type="text" id="giftBox" maxlength="100" placeholder="VD: H·ªôp g·ªó cao c·∫•p">
                </div>
                <div class="form-group">
                    <label>Lo·∫°i Thi·ªáp</label>
                    <input type="text" id="greetingCard" maxlength="100" placeholder="VD: Thi·ªáp ch√∫c m·ª´ng">
                </div>
                <div class="form-group">
                    <label>Lo·∫°i Gi·∫•y G√≥i</label>
                    <input type="text" id="paperType" maxlength="100" placeholder="VD: Gi·∫•y kraft">
                </div>
                <div class="form-group">
                    <label>M√¥ T·∫£</label>
                    <textarea id="description" placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ g√≥i qu√†..."></textarea>
                </div>
                <div class="form-group">
                    <label>Ph√≠ G√≥i Qu√† (‚Ç´) *</label>
                    <input type="number" id="packageFee" required min="0" step="1000" value="0">
                </div>
                <div class="form-group">
                    <label>URL H√¨nh ·∫¢nh</label>
                    <input type="text" id="imageURL" maxlength="255" placeholder="https://...">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                    <button type="button" class="btn btn-outline" onclick="closeModal()">H·ªßy</button>
                </div>
            </form>
        </div>
    </div>
    <script src="/js/notification.js"></script>
    <script>
        let editMode = false, allPackages = [];
        function loadPackages() {
            fetch('/admin/api/gift-packages', { credentials: 'include' })
                .then(r => r.json())
                .then(packages => { allPackages = packages; displayPackages(packages); })
                .catch(() => document.getElementById('packagesTable').innerHTML = '<tr><td colspan="8" style="text-align:center">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu</td></tr>');
        }
        function displayPackages(packages) {
            document.getElementById('packagesTable').innerHTML = packages.length ? packages.map(p => `
                <tr>
                    <td>${p.giftPackageId}</td>
                    <td>${p.imageURL ? `<img src="${p.imageURL}" class="package-image" alt="${p.packageName}">` : 'N/A'}</td>
                    <td>${p.packageName}</td>
                    <td>${p.giftBox || 'N/A'}</td>
                    <td>${p.greetingCard || 'N/A'}</td>
                    <td>${p.paperType || 'N/A'}</td>
                    <td>${(p.packageFee || 0).toLocaleString('vi-VN')} ‚Ç´</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick='editPackage(${JSON.stringify(p)})'>S·ª≠a</button>
                        <button class="btn btn-sm btn-danger" onclick="deletePackage(${p.giftPackageId})">X√≥a</button>
                    </td>
                </tr>
            `).join('') : '<tr><td colspan="8" style="text-align:center">Kh√¥ng t√¨m th·∫•y g√≥i qu√†</td></tr>';
        }
        function filterPackages() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allPackages.filter(p =>
                (p.packageName || '').toLowerCase().includes(q) ||
                (p.giftBox || '').toLowerCase().includes(q) ||
                (p.greetingCard || '').toLowerCase().includes(q) ||
                (p.paperType || '').toLowerCase().includes(q) ||
                (p.giftPackageId + '').includes(q)
            );
            displayPackages(filtered);
        }
        function showAddModal() {
            editMode = false;
            document.getElementById('modalTitle').textContent = 'Th√™m G√≥i Qu√† M·ªõi';
            document.getElementById('packageForm').reset();
            document.getElementById('packageId').value = '';
            document.getElementById('packageModal').classList.add('show');
        }
        function editPackage(pkg) {
            editMode = true;
            document.getElementById('modalTitle').textContent = 'S·ª≠a Th√¥ng Tin G√≥i Qu√†';
            document.getElementById('packageId').value = pkg.giftPackageId;
            document.getElementById('packageName').value = pkg.packageName;
            document.getElementById('giftBox').value = pkg.giftBox || '';
            document.getElementById('greetingCard').value = pkg.greetingCard || '';
            document.getElementById('paperType').value = pkg.paperType || '';
            document.getElementById('description').value = pkg.description || '';
            document.getElementById('packageFee').value = pkg.packageFee || 0;
            document.getElementById('imageURL').value = pkg.imageURL || '';
            document.getElementById('packageModal').classList.add('show');
        }
        function closeModal() {
            document.getElementById('packageModal').classList.remove('show');
        }
        document.getElementById('packageForm').onsubmit = function (e) {
            e.preventDefault();
            const data = {
                packageName: document.getElementById('packageName').value,
                giftBox: document.getElementById('giftBox').value,
                greetingCard: document.getElementById('greetingCard').value,
                paperType: document.getElementById('paperType').value,
                description: document.getElementById('description').value,
                packageFee: parseFloat(document.getElementById('packageFee').value),
                imageURL: document.getElementById('imageURL').value
            };
            const url = editMode ? `/admin/api/gift-packages/${document.getElementById('packageId').value}` : '/admin/api/gift-packages';
            const method = editMode ? 'PUT' : 'POST';
            fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data), credentials: 'include' })
                .then(r => {
                    if (!r.ok) throw new Error('L·ªói khi l∆∞u');
                    return r.json();
                })
                .then(() => { showSuccess('Th√†nh C√¥ng', editMode ? 'ƒê√£ c·∫≠p nh·∫≠t g√≥i qu√†' : 'ƒê√£ th√™m g√≥i qu√† m·ªõi'); closeModal(); loadPackages(); })
                .catch(() => showError('L·ªói', 'Kh√¥ng th·ªÉ l∆∞u g√≥i qu√†'));
        };
        function deletePackage(id) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a g√≥i qu√† n√†y?')) return;
            fetch(`/admin/api/gift-packages/${id}`, { method: 'DELETE', credentials: 'include' })
                .then(r => {
                    if (!r.ok) throw new Error('L·ªói khi x√≥a');
                    showSuccess('Th√†nh C√¥ng', 'ƒê√£ x√≥a g√≥i qu√†');
                    loadPackages();
                })
                .catch(() => showError('L·ªói', 'Kh√¥ng th·ªÉ x√≥a g√≥i qu√†'));
        }
        loadPackages();
    </script>
</body>

</html>