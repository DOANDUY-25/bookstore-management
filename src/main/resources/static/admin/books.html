<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω S√°ch - Admin</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="admin-style.css">
    <style>
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center
        }

        .modal.show {
            display: flex
        }

        .modal-content {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto
        }

        .form-group {
            margin-bottom: 1rem
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px
        }

        .form-group textarea {
            min-height: 100px
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem
        }
    </style>
</head>

<body>
    <div class="admin-container">
        <aside class="admin-sidebar">
            <h2>Admin Panel</h2>
            <ul class="admin-menu">
                <li><a href="/admin/dashboard.html">Dashboard</a></li>
                <li><a href="/admin/books.html" class="active">Qu·∫£n L√Ω S√°ch</a></li>
                <li><a href="/admin/orders.html">Qu·∫£n L√Ω ƒê∆°n H√†ng</a></li>
                <li><a href="/admin/gift-orders.html">Qu·∫£n L√Ω ƒê∆°n Qu√† T·∫∑ng</a></li>
                <li><a href="/admin/gift-packages.html">Qu·∫£n L√Ω G√≥i Qu√†</a></li>
                <li><a href="/admin/users.html">Qu·∫£n L√Ω Ng∆∞·ªùi D√πng</a></li>
                <li><a href="/admin/memberships.html">Qu·∫£n L√Ω Th·∫ª Th√†nh Vi√™n</a></li>
                <li><a href="/index.html">V·ªÅ Trang Ch·ªß</a></li>
            </ul>
        </aside>
        <main class="admin-content">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem">
                <h1 style="color:#2d6a4f;margin:0">Qu·∫£n L√Ω S√°ch</h1>
                <button class="btn btn-primary" onclick="showAddModal()">Th√™m S√°ch M·ªõi</button>
            </div>
            <div style="margin-bottom:1rem">
                <input type="text" id="searchInput" placeholder="üîç T√¨m ki·∫øm theo t√™n, t√°c gi·∫£, th·ªÉ lo·∫°i, ID..."
                    style="width:100%;max-width:500px;padding:0.75rem;border:1px solid #ddd;border-radius:4px;font-size:14px"
                    oninput="filterBooks()">
            </div>
            <div class="admin-section">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>T√™n S√°ch</th>
                            <th>T√°c Gi·∫£</th>
                            <th>Th·ªÉ Lo·∫°i</th>
                            <th>Gi√°</th>
                            <th>T·ªìn Kho</th>
                            <th>Thao T√°c</th>
                        </tr>
                    </thead>
                    <tbody id="booksTable">
                        <tr>
                            <td colspan="7" style="text-align:center">ƒêang t·∫£i...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>
    <div id="bookModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Th√™m S√°ch M·ªõi</h2>
            <form id="bookForm">
                <div class="form-group">
                    <label>ID</label>
                    <input type="number" id="bookId" readonly style="background:#f5f5f5">
                </div>
                <div class="form-group">
                    <label>T√™n S√°ch *</label>
                    <input type="text" id="title" required maxlength="255">
                </div>
                <div class="form-group">
                    <label>T√°c Gi·∫£</label>
                    <input type="text" id="author" maxlength="255">
                </div>
                <div class="form-group">
                    <label>Th·ªÉ Lo·∫°i</label>
                    <input type="text" id="category" maxlength="100">
                </div>
                <div class="form-group">
                    <label>Gi√° *</label>
                    <input type="number" id="price" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>T·ªìn Kho *</label>
                    <input type="number" id="stock" required min="0">
                </div>
                <div class="form-group">
                    <label>M√¥ T·∫£</label>
                    <textarea id="description"></textarea>
                </div>
                <div class="form-group">
                    <label>URL ·∫¢nh B√¨a</label>
                    <input type="text" id="coverImageURL" maxlength="255">
                </div>
                <div class="form-group">
                    <label>ƒê√°nh Gi√° (0-5)</label>
                    <input type="number" id="rating" min="0" max="5" step="0.1" value="0">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                    <button type="button" class="btn btn-outline" onclick="closeModal()">H·ªßy</button>
                </div>
            </form>
        </div>
    </div>
    <script src="/js/notification.js"></script>
    <script>
        let editMode = false, allBooks = [];
        function loadBooks() {
            fetch('/api/books', { credentials: 'include' })
                .then(r => r.json())
                .then(books => { allBooks = books; displayBooks(books); })
                .catch(() => document.getElementById('booksTable').innerHTML = '<tr><td colspan="7" style="text-align:center">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu</td></tr>');
        }
        function displayBooks(books) {
            document.getElementById('booksTable').innerHTML = books.length ? books.map(b => `
                <tr>
                    <td>${b.bookId}</td>
                    <td>${b.title}</td>
                    <td>${b.author || 'N/A'}</td>
                    <td>${b.category || 'N/A'}</td>
                    <td>${(b.price || 0).toLocaleString('vi-VN')} ‚Ç´</td>
                    <td>${b.stock || 0}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick='editBook(${JSON.stringify(b)})'>S·ª≠a</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteBook(${b.bookId})">X√≥a</button>
                    </td>
                </tr>
            `).join('') : '<tr><td colspan="7" style="text-align:center">Kh√¥ng t√¨m th·∫•y s√°ch</td></tr>';
        }
        function filterBooks() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allBooks.filter(b =>
                (b.title || '').toLowerCase().includes(q) ||
                (b.author || '').toLowerCase().includes(q) ||
                (b.category || '').toLowerCase().includes(q) ||
                (b.bookId + '').includes(q)
            );
            displayBooks(filtered);
        }
        function showAddModal() {
            editMode = false;
            document.getElementById('modalTitle').textContent = 'Th√™m S√°ch M·ªõi';
            document.getElementById('bookForm').reset();
            document.getElementById('bookId').value = '';
            document.getElementById('bookModal').classList.add('show');
        }
        function editBook(book) {
            editMode = true;
            document.getElementById('modalTitle').textContent = 'S·ª≠a Th√¥ng Tin S√°ch';
            document.getElementById('bookId').value = book.bookId;
            document.getElementById('title').value = book.title;
            document.getElementById('author').value = book.author || '';
            document.getElementById('category').value = book.category || '';
            document.getElementById('price').value = book.price || 0;
            document.getElementById('stock').value = book.stock || 0;
            document.getElementById('description').value = book.description || '';
            document.getElementById('coverImageURL').value = book.coverImageURL || '';
            document.getElementById('rating').value = book.rating || 0;
            document.getElementById('bookModal').classList.add('show');
        }
        function closeModal() {
            document.getElementById('bookModal').classList.remove('show');
        }
        document.getElementById('bookForm').onsubmit = function (e) {
            e.preventDefault();
            const data = {
                title: document.getElementById('title').value,
                author: document.getElementById('author').value,
                category: document.getElementById('category').value,
                price: parseFloat(document.getElementById('price').value),
                stock: parseInt(document.getElementById('stock').value),
                description: document.getElementById('description').value,
                coverImageURL: document.getElementById('coverImageURL').value,
                rating: parseFloat(document.getElementById('rating').value) || 0
            };
            const url = editMode ? `/admin/api/books/${document.getElementById('bookId').value}` : '/admin/api/books';
            const method = editMode ? 'PUT' : 'POST';
            fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data), credentials: 'include' })
                .then(r => r.json())
                .then(() => { showSuccess('Th√†nh C√¥ng', editMode ? 'ƒê√£ c·∫≠p nh·∫≠t s√°ch' : 'ƒê√£ th√™m s√°ch m·ªõi'); closeModal(); loadBooks(); })
                .catch(() => showError('L·ªói', 'Kh√¥ng th·ªÉ l∆∞u s√°ch'));
        };
        function deleteBook(id) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s√°ch n√†y?')) return;
            fetch(`/admin/api/books/${id}`, { method: 'DELETE', credentials: 'include' })
                .then(() => { showSuccess('Th√†nh C√¥ng', 'ƒê√£ x√≥a s√°ch'); loadBooks(); })
                .catch(() => showError('L·ªói', 'Kh√¥ng th·ªÉ x√≥a s√°ch'));
        }
        loadBooks();
    </script>
</body>

</html>